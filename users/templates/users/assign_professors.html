{% extends 'base.html' %}
{% block title %}Asignar profesores{% endblock %}
{% block content %}
  <h1>
    {% if subject %}
      Asignar profesores a {{ subject.name }} ({{ subject.code }})
    {% elif final %}
      Asignar profesores a {{ final.subject.name }} - {{ final.date }}
    {% else %}
      Asignar profesores
    {% endif %}
  </h1>

  <form method="post">
    {% csrf_token %}
    <div class="mb-3">

      {% if subject %}
        {% with assigned=subject.professors.all %}
          {% for p in professors %}
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="professors" value="{{ p.pk }}" id="p{{ p.pk }}"
                     {% if p in assigned %}checked{% endif %}>
              <label class="form-check-label" for="p{{ p.pk }}">
                {{ p.user.get_full_name }}{% if p.professor_id %} ({{ p.professor_id }}){% endif %}
              </label>
            </div>
          {% empty %}
            <p>No hay profesores disponibles.</p>
          {% endfor %}
        {% endwith %}

      {% elif final %}
        {% with assigned=final.professors.all %}
          {% for p in professors %}
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="professors" value="{{ p.pk }}" id="p{{ p.pk }}"
                     {% if p in assigned %}checked{% endif %}>
              <label class="form-check-label" for="p{{ p.pk }}">
                {{ p.user.get_full_name }}{% if p.professor_id %} ({{ p.professor_id }}){% endif %}
              </label>
            </div>
          {% empty %}
            <p>No hay profesores disponibles.</p>
          {% endfor %}
        {% endwith %}

      {% else %}
        {% for p in professors %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="professors" value="{{ p.pk }}" id="p{{ p.pk }}">
            <label class="form-check-label" for="p{{ p.pk }}">
              {{ p.user.get_full_name }}{% if p.professor_id %} ({{ p.professor_id }}){% endif %}
            </label>
          </div>
        {% empty %}
          <p>No hay profesores disponibles.</p>
        {% endfor %}
      {% endif %}

    </div>

    <button class="btn btn-primary">Guardar</button>
    <a class="btn btn-secondary" href="{% if subject %}{% url 'users:subject-list' %}{% else %}{% url 'users:final-list' %}{% endif %}">Volver</a>
  </form>
{% endblock %}
