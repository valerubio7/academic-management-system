{% extends 'base.html' %}
{% block title %}Panel Estudiante{% endblock %}
{% block content %}
<h1>Panel de Estudiante</h1>


<div class="mb-3">
  <a class="btn btn-primary" href="{% url 'users:student-regular-certificate' %}">Descargar certificado de alumno regular</a>
  <small class="text-muted d-block">Se genera a partir de la plantilla regular_certificate.docx</small>
  
</div>

<!-- Subjects available -->
<div class="row">
  <div class="col-md-6">
    <h3>Materias de mi carrera</h3>
    <ul class="list-group">
      {% for s in subjects %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ s.name }}</strong> <small class="text-muted">({{ s.code }})</small>
        </div>

        {% if s.code in inscribed_subject_codes %}
          <button class="btn btn-sm btn-secondary" disabled>Inscripto</button>
        {% else %}
          <form method="post" action="{% url 'users:subject-inscribe' s.code %}">
            {% csrf_token %}
            <button class="btn btn-sm btn-success">Inscribirme</button>
          </form>
        {% endif %}
      </li>
      {% empty %}
      <li class="list-group-item">Sin materias</li>
      {% endfor %}
    </ul>
  </div>

  <div class="col-md-6">
    <h3>Mis inscripciones a materias</h3>
    <ul class="list-group">
      {% for ins in inscriptions %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ ins.subject.name }}
      </li>
      {% empty %}
      <li class="list-group-item">Sin inscripciones</li>
      {% endfor %}
    </ul>
  </div>
</div>

<hr/>

<h3>Finales disponibles</h3>
<ul class="list-group mb-3">
  {% for fe in eligible_finals %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    <div>
      {{ fe.subject.name }} - {{ fe.date }} {% if fe.call_number %}- Llamado {{ fe.call_number }}{% endif %}
    </div>

    {% if fe.id in inscribed_final_ids %}
      <button class="btn btn-sm btn-secondary" disabled>Inscripto</button>
    {% else %}
      <form method="post" action="{% url 'users:final-inscribe' fe.id %}">
        {% csrf_token %}
        <button class="btn btn-sm btn-success">Inscribirme</button>
      </form>
    {% endif %}
  </li>
  {% empty %}
  <li class="list-group-item">No hay finales disponibles.</li>
  {% endfor %}
</ul>

<h3>Mis inscripciones a finales</h3>
<ul class="list-group mb-3">
  {% for fi in final_inscriptions %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    <div>
      {{ fi.final_exam.subject.name }} - {{ fi.final_exam.date }} {% if fi.final_exam.call_number %}- Llamado {{ fi.final_exam.call_number }}{% endif %}
    </div>
    <span class="badge bg-secondary">Inscripto</span>
  </li>
  {% empty %}
  <li class="list-group-item">Aún no te inscribiste a ningún final.</li>
  {% endfor %}
  </ul>

<h3>Mis notas</h3>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Materia</th><th>Promoción</th><th>Final</th><th>Estado</th>
    </tr>
  </thead>
  <tbody>
    {% for g in grades %}
    <tr>
      <td>{{ g.subject.name }}</td>
      <td>{{ g.promotion_grade|default:'-' }}</td>
      <td>{{ g.final_grade|default:'-' }}</td>
      <td>{{ g.get_status_display }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="4">Sin notas</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
